<html>
  <head>
    <title>Water Cannister</title>
    <style>
      
      body { margin: 0px; padding: 0px }

      canvas {
          display: block;
          width: 100%;
          height: 100%;
      }

    </style>
    <script src="https://cs.wellesley.edu/~cs307/threejs/libs/three-r80.min.js"></script>
    <script src="https://cs.wellesley.edu/~cs307/threejs/libs/tw.js"></script>
    <script src="https://cs.wellesley.edu/~cs307/threejs/libs/OrbitControls.js"></script>
  </head>
<body>

<script>

var sceneParams = {
  legRadius:2,
  handleRadius: .3,
  handleHeight: 3,
  cylinderRadius: 4.5,
  cylinderHeight: 15,
  radiusSegments: 32,
  metalColor: 0x808080,
  metalSpecular: 0x444444,
  seatColor: 0xFF0000,
  seatShininess: 30,
  metalShininess: 5,
  sphereRadius: 15,
  spotlightColor: 0xffffff,
  spotlightExponentt: 100,

}

var scene = new THREE.Scene();
var renderer = new THREE.WebGLRenderer();

TW.mainInit(renderer,scene);

function createLeg(){

  var leg = new THREE.Object3D();
  var legs = new THREE.Object3D();

  var thighGeometry = new THREE.SphereGeometry( sceneParams.legRadius, sceneParams.radiusSegments, sceneParams.radiusSegments );
  var thighMaterial = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess});
  var thighSphere = new THREE.Mesh( thighGeometry, thighMaterial );

  var calfGeometry = new THREE.SphereGeometry( sceneParams.legRadius, sceneParams.radiusSegments, sceneParams.radiusSegments );
  var calfMaterial = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess});
  var calfSphere = new THREE.Mesh( calfGeometry, calfMaterial );

  var footGeometry = new THREE.SphereGeometry( sceneParams.legRadius*.9, sceneParams.radiusSegments, sceneParams.radiusSegments );
  var footMaterial = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess});
  var footSphere = new THREE.Mesh( footGeometry, footMaterial );
  
  thighSphere.scale.set(.3,1,.3);
  thighSphere.rotation.z = Math.PI/2.5;

  calfSphere.scale.set(.2,.6,.2);
  calfSphere.rotation.z = -Math.PI/5;
  calfSphere.position.x = sceneParams.legRadius*.55;
  calfSphere.position.y = -sceneParams.legRadius*.6;
  footSphere.position.y = -sceneParams.legRadius*.8;
  footSphere.scale.set(.15,.4,.2);
  footSphere.rotation.z = Math.PI/2.5;
  footSphere.position.x = sceneParams.legRadius*.5;
  footSphere.position.y = -sceneParams.legRadius*1.1;

  leg.add(calfSphere);
  leg.add(thighSphere);
  leg.add(footSphere);

  var leg2 = leg.clone();
  var leg3 = leg.clone();
  var leg4 = leg.clone();

  leg.position.y = sceneParams.legRadius*1.2;
  leg.position.x = sceneParams.cylinderRadius;

  leg2.position.y = sceneParams.legRadius*1.2;
  leg2.position.x = -sceneParams.cylinderRadius;
  leg2.rotation.y = Math.PI;

  leg3.position.y = sceneParams.legRadius*1.2;
  leg3.position.z = -sceneParams.cylinderRadius;
  leg3.rotation.y = Math.PI/2;

  leg4.position.y = sceneParams.legRadius*1.2;
  leg4.position.z = sceneParams.cylinderRadius;
  leg4.rotation.y = -Math.PI/2;

  legs.add(leg);
  legs.add(leg2);
  legs.add(leg3);
  legs.add(leg4);

  return legs;

}

function createHandle(){
  var handle = new THREE.Object3D();

  var geometry = new THREE.CylinderGeometry( sceneParams.handleRadius, sceneParams.handleRadius, sceneParams.handleHeight, sceneParams.radiusSegments );
  var material = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess});
  var cylinder1 = new THREE.Mesh( geometry, material );

  cylinder1.rotation.x = (Math.PI /2);
  cylinder1.position.y = (sceneParams.handleHeight *.6)/2;


  var geometry2 = new THREE.CylinderGeometry( sceneParams.handleRadius, sceneParams.handleRadius, sceneParams.handleHeight, sceneParams.radiusSegments );
  var material2 = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess});
  var cylinder2 = new THREE.Mesh( geometry, material );
  cylinder2.scale.set(.8,.6,.8);

  handle.add(cylinder1);
  handle.add(cylinder2);

  return handle;

}

function createCylinder(){

  var geometry = new THREE.CylinderGeometry( sceneParams.cylinderRadius, sceneParams.cylinderRadius, sceneParams.cylinderHeight, sceneParams.radiusSegments );
  var material = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess});
  var cylinder = new THREE.Mesh( geometry, material );
  return cylinder;
}

function printPoints(points) {
    var i;
    console.log("[");
    for( i=0; i < points.length; i++) {
        p = points[i];
        console.log("["+p.x+","+p.y+"],");
    }
    console.log("]");
}

function makeVertices(points) {
    var i;
    var pts = [];
    for( i = 0; i < points.length; i++) {
        var p = points[i]; 
        pts.push(new THREE.Vector3( p[0], p[1], 0));
    }

    return pts;
}
    
function remakeSplineObj(spline) { //catmulrom etc

  var splineVertices = [ [5, 0],
               [4, 2],
               [1, 4],
               [3, 2],
               [1.5, 5],
               [.5, 5.5] ];

    scene.remove(spline);
    var mat = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess});
    curve = new THREE.CatmullRomCurve3 ( makeVertices(splineVertices) );
    var geom = new THREE.Geometry();
    geom.vertices = curve.getPoints(5);
    splineObj = new THREE.Line( geom, new THREE.LineBasicMaterial( { linewidth: 3, color: 0x00ff00 }) );
    splineObj.name = "spline";

    return splineObj;
}

function remakeLatheObj(lathe) {
    scene.remove(lathe);
    var geom = new THREE.LatheGeometry( splineObj.geometry.vertices );
    var mat1 = new THREE.MeshPhongMaterial({color: sceneParams.metalColor,
                                             opacity: 0.6, 
                                             specular: sceneParams.metalSpecular,
                                             shininess: sceneParams.metalShininess,
                                             side: THREE.DoubleSide, 
                                             wireframe: false,
                                           });
    latheObj = new THREE.Mesh (geom, mat1);
    latheObj.name = "lathe";

    return latheObj;
}

function createCannister(){

var splineObj;
var latheObj;
var splineStand = remakeSplineObj(splineObj);
var latheStand = remakeLatheObj(latheObj);
var body = createCylinder();
var cannisterHandle = createHandle();
var leg = createLeg();

latheStand.position.y = sceneParams.cylinderHeight + sceneParams.legRadius;
body.position.y = sceneParams.cylinderHeight/2 + sceneParams.legRadius;
cannisterHandle.position.y = (sceneParams.cylinderHeight * 1.5 - sceneParams.handleHeight*.6) + sceneParams.legRadius;

scene.add(latheStand);
scene.add(body);
scene.add(cannisterHandle);
scene.add(leg);
}

createCannister();

var cameraFOVY = 100;

//-------------------------
// TESTING WITH LIGHTING
//-------------------------

    //create a spotlight
    var spotLight = new THREE.SpotLight( sceneParams.spotlightColor );
    spotLight.name = "spot";
    spotLight.position.set(10,50,50); 

    spotLight.target.position.set = (0,20,0);
    
    scene.add(spotLight);
    scene.add(spotLight.target);

var ambLight = new THREE.AmbientLight( sceneParams.ambLightColor); // soft white light 
    ambLight.name = "ambient";
    scene.add( ambLight );

var state = TW.cameraSetup(renderer,
                           scene,
                           {minx: -10, maxx: 10,
                            miny: 0, maxy: (sceneParams.cylinderHeight + sceneParams.cylinderHeight) + 1.2,
                            minz: -10, maxz: 10},
                           cameraFOVY);

TW.render();

</script>
</body>
</html>

